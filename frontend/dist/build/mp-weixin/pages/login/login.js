"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t={__name:"login",setup(t){const n=e.ref(""),a=e.ref(""),s=async()=>{if(!n.value||!a.value)return void e.index.showToast({title:"请输入邮箱和密码",icon:"none"});if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value)){e.index.showLoading({title:"登录中..."});try{const o=await e.index.request({url:"http://localhost:3000/api/auth/login",method:"POST",data:{email:n.value,password:a.value},header:{"Content-Type":"application/json"}});if(e.index.hideLoading(),200===o.statusCode){const t=o.data;e.index.setStorageSync("token",t.token),e.index.setStorageSync("userId",t.userId),e.index.setStorageSync("nickname",t.nickname),e.index.showToast({title:t.message||"登录成功",icon:"success",duration:1500}),e.index.reLaunch({url:"/pages/index/index"})}else{const t=o.data;let n="登录失败，请稍后再试";t&&t.error&&t.error.message?n=t.error.message:400===o.statusCode?n="输入信息不符合要求，请检查":401===o.statusCode&&(n="邮箱或密码错误"),e.index.showToast({title:n,icon:"none",duration:2e3})}}catch(o){e.index.hideLoading(),console.error("Login error:",o),e.index.showToast({title:"网络错误或服务器无响应",icon:"none",duration:2e3})}}else e.index.showToast({title:"请输入有效的邮箱地址",icon:"none"})},i=()=>{e.index.navigateTo({url:"/pages/register/register"})},r=()=>{e.index.showToast({title:"“忘记密码”功能暂未开放",icon:"none"})};return(t,d)=>({a:o._imports_1,b:n.value,c:e.o((e=>n.value=e.detail.value)),d:a.value,e:e.o((e=>a.value=e.detail.value)),f:e.o(s),g:e.o(r),h:e.o(i)})}},n=e._export_sfc(t,[["__scopeId","data-v-cf2b0e9b"]]);wx.createPage(n);
