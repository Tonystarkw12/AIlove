"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),t={__name:"register",setup(t){const a=e.ref(""),n=e.ref(""),i=e.ref(""),s=e.ref(""),r=async()=>{if(!(a.value&&n.value&&i.value&&s.value))return void e.index.showToast({title:"请填写所有必填项！",icon:"none"});if(i.value!==s.value)return void e.index.showToast({title:"两次输入的密码不一致！",icon:"none"});if(i.value.length<8)return void e.index.showToast({title:"密码长度至少为8位！",icon:"none"});if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value)){e.index.showLoading({title:"注册中..."});try{const o=await e.index.request({url:"http://localhost:3000/api/auth/register",method:"POST",data:{nickname:a.value,email:n.value,password:i.value},header:{"Content-Type":"application/json"}});if(e.index.hideLoading(),201===o.statusCode){const t=o.data;e.index.setStorageSync("token",t.token),e.index.setStorageSync("userId",t.userId),e.index.setStorageSync("nickname",a.value),e.index.showToast({title:t.message||"注册成功",icon:"success",duration:1500}),e.index.reLaunch({url:"/pages/index/index"})}else{const t=o.data;let a="注册失败，请稍后再试";t&&t.error&&t.error.message?a=t.error.message:400===o.statusCode?a="输入信息不符合要求，请检查。":409===o.statusCode&&(a="邮箱或昵称已被占用。"),e.index.showToast({title:a,icon:"none",duration:2500})}}catch(o){e.index.hideLoading(),console.error("Registration error:",o),e.index.showToast({title:"网络错误或服务器无响应",icon:"none",duration:2500})}}else e.index.showToast({title:"请输入有效的邮箱地址！",icon:"none"})},l=()=>{e.index.navigateTo({url:"/pages/login/login"})},d=()=>{e.index.showToast({title:"查看服务条款",icon:"none"})},u=()=>{e.index.showToast({title:"查看隐私政策",icon:"none"})};return(t,c)=>({a:o._imports_1,b:a.value,c:e.o((e=>a.value=e.detail.value)),d:n.value,e:e.o((e=>n.value=e.detail.value)),f:i.value,g:e.o((e=>i.value=e.detail.value)),h:s.value,i:e.o((e=>s.value=e.detail.value)),j:e.o(r),k:e.o(d),l:e.o(u),m:e.o(l)})}},a=e._export_sfc(t,[["__scopeId","data-v-7dfcb81d"]]);wx.createPage(a);
